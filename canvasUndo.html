<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <style>
    #myCanvas {
        border: 1px black dotted;
        /* A bit of border so that we can see our canvas */
    }
    </style>
</head>        
<body>
    <button id='undo'>â†©</button>
    <canvas width='500px' height='500px' id='myCanvas'></canvas>
    <ol id='history'>
    </ol>
    <script>
        
var lineCol = "#808080";
var lineWid = 50;
var lineOpacity = 1;
var lineSoftness = 20;

var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext('2d');
var line = function (x1, y1, x2, y2, lineTemp) {
    ctx.beginPath();
    ctx.lineCap = "round";
    ctx.moveTo(x1, y1);
    ctx.lineWidth = lineTemp;
    ctx.lineTo(x2, y2);
    ctx.strokeStyle = lineCol;
    ctx.stroke();
    ctx.closePath();};
   var drawLine = function(drawing) {  
        var color = drawing.lineCol;
        var width = drawing.lineWid;
        var opacity = drawing.lineOpacity;
        var lineSoft = drawing.lineSoftness;
        var mpX = drawing.x1;
        var mpY = drawing.y1;
        var ex = drawing.x2;
        var ey = drawing.y2;
        var tempWid = drawing.lineWid;
        var omo = 0.0;
       
        if (lineSoft > 30) {
            tempWid = tempWid * 1.4;
        } else if (lineSoft > 40) {
            tempWid = tempWid * 1.45;
        } else if (lineSoft > 50) {
            tempWid = tempWid * 1.5;
        } else if (lineSoft > 60) {
            tempWid = tempWid * 1.6;
        } else if (lineSoft > 70) {
            tempWid = tempWzid * 1.7;
        } else if (lineSoft > 80) {
            tempWid = tempWid * 1.8;
        } else if (lineSoft > 90) {
            tempWid = tempWid * 1.9;
        }
        if (lineSoft > 100) {lineSoft = 100;}
        var opacityCutoff = tempWid - ((lineOpacity) * tempWid);
        while (tempWid > opacityCutoff) {
            ctx.globalAlpha = omo / 100.0;
            line(mpX, mpY, ex, ey, tempWid, color);
            tempWid = tempWid - (lineSoft) / 20.0;
            omo = omo + (lineOpacity) * .8;}
        updateMousePosition(event);}
    // An array to hold our drawing commands
    var drawingCommands = [];

    // A div to hold the history of our drawing commands
    var drawingHistory = document.querySelector('#history');

    var clearScreen = function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    var redrawLines = function() {
        drawingCommands.forEach(function(drawing) {
            drawLine(drawing);
        });
    };

    var mouseIsDown = false; // a variable we'll toggle to keep track of whether the mouse is down

    var mousePosition = { // a convenience dictionary for storing our mouse's x- and y-coordinates
        x: null,
        y: null
    };
    var updateMousePosition = function(event) { // a function to take a MouseEvent and update our mousePosition dictionary with the right x- and y-coordinates from the MouseEvent
        mousePosition.x = event.offsetX;
        mousePosition.y = event.offsetY;
    };

//    var drawLine = function(drawing) {
//        line(drawing.x1, drawing.y1, drawing.x2, drawing.y2);
//    };

    var Drawing = function(x1, y1, x2, y2, lineCol, lineWid, lineOpacity, lineSoftness) {
        // A class to represent a single, drawn line
        this.x1 = x1;
        this.y1 = y1;
        this.x2 = x2;
        this.y2 = y2;
        this.lineCol = lineCol;
        this.lineWid = lineWid;
        this.lineOpacity = lineOpacity;
        this.lineSoftness = lineSoftness;

        this.log = function() {
            // A method for each drawing which can output a human-readable string representing the line
            return "(" + this.x1 + ', ' + this.y1 + ') => (' + this.x2 + ', ' + this.y2 + ') => (' + this.lineCol + ', '+ this.lineOpacity + ', '+ this.lineSoftness + ', '+ this.lineWid + ')';
        };
    };

    canvas.addEventListener('mousedown', function(event) { // When the mouse button is pressed down on the canvas element
        mouseIsDown = true; // toggle mouseIsDown
        updateMousePosition(event); // update the mousePosition
    });
    canvas.addEventListener('mouseup', function(event) { // When we release the mouse button on the canvas element
        mouseIsDown = false; // toggle mouseIsDown
    });

    canvas.addEventListener('mousemove', function(event) { // When the mouse is moved over the canvas element
        if (mouseIsDown) { // If the mouse button is also down (i.e. if we're dragging)
            var drawing = new Drawing(mousePosition.x, mousePosition.y, event.offsetX, event.offsetY, lineCol, lineWid, lineOpacity, lineSoftness);
            var li = document.createElement('li');
            li.innerText = drawing.log();
            drawingHistory.appendChild(li);

            drawingCommands.push(drawing);
            clearScreen();
            redrawLines();

            updateMousePosition(event); // and then update our mousePosition coordinates
        }
    });

    // Grab our undo button
    var undo = document.querySelector('#undo');

    // When you click the undo button
    undo.addEventListener('click', function() {
        var undoLength = 5; // A variable to set how far back to undo
        // Redefine `drawingCommands` as what it was, but `undoLength` shorter
        drawingCommands = drawingCommands.slice(0, drawingCommands.length - undoLength);

        // Clear our screen
        clearScreen();

        // Redraw the lines in `drawingCommands`, now `undoLength` elements shorter
        redrawLines();
    });
    </script>
</body>

</html>
